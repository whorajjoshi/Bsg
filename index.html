<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BSG Release Order</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:Inter}
body{
  margin:0;
  background:#f2f4f7;
}

/* ===== PREMIUM HEADER ===== */
.header{
  background:linear-gradient(135deg,#0b3d2e,#0f5132,#198754);
  padding:18px 16px 22px;
  box-shadow:0 10px 25px rgba(0,0,0,.25);
}
.header-inner{
  max-width:440px;
  margin:0 auto;
  display:flex;
  align-items:center;
  gap:14px;
}
.header-logo{
  width:48px;
  height:48px;
  background:#fff;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 4px 10px rgba(0,0,0,.2);
}
.header-logo img{
  width:30px;
}
.header-text h1{
  margin:0;
  font-size:16px;
  font-weight:700;
  color:#fff;
  line-height:1.2;
}
.header-text p{
  margin:2px 0 0;
  font-size:11px;
  color:#e5f3ee;
}

/* ===== CARD ===== */
.card{
  max-width:440px;
  background:#fff;
  margin:18px auto;
  padding:20px;
  border-radius:22px;
  box-shadow:0 18px 40px rgba(0,0,0,.18);
}

/* ===== FORM ===== */
label{
  font-size:12px;
  font-weight:600;
  color:#6b7280;
}
input,select{
  width:100%;
  padding:12px 14px;
  margin:6px 0 14px;
  border-radius:14px;
  border:1px solid #d1d5db;
  background:#f9fafb;
  font-size:14px;
}
input:focus,select:focus{
  outline:none;
  border-color:#198754;
  background:#fff;
}

/* FILE */
.file-box{
  border:2px dashed #cbd5e1;
  border-radius:16px;
  padding:16px;
  text-align:center;
  font-size:13px;
  color:#64748b;
}

/* BUTTON */
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:16px;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
  color:#fff;
  background:linear-gradient(135deg,#0b3d2e,#198754);
  margin-top:8px;
}

/* ===== PREVIEW ===== */
.preview{display:none;}
.preview-card{
  background:#f9fafb;
  border-radius:16px;
  padding:14px;
  font-size:14px;
}
.preview-card b{color:#0b3d2e}
.preview-img{
  width:100%;
  border-radius:12px;
  margin-top:10px;
}
.pdf-box{
  margin-top:10px;
  padding:12px;
  border:1px solid #e5e7eb;
  border-radius:12px;
  background:#fff;
}

/* ACTIONS */
.actions{
  display:flex;
  gap:10px;
  margin-top:12px;
}
.back{
  background:#6b7280;
}
.confirm{
  background:linear-gradient(135deg,#0b3d2e,#198754);
}

/* LOADER */
.loader{
  display:none;
  text-align:center;
  margin-top:15px;
}
.loader span{
  width:10px;
  height:10px;
  background:#0b3d2e;
  border-radius:50%;
  display:inline-block;
  margin:0 4px;
  animation:b 1.4s infinite;
}
.loader span:nth-child(2){animation-delay:.2s}
.loader span:nth-child(3){animation-delay:.4s}
@keyframes b{
  0%,80%,100%{transform:scale(0)}
  40%{transform:scale(1)}
}

/* STATUS */
#status{
  margin-top:14px;
  text-align:center;
  font-weight:600;
}

/* FOOTER */
.footer{
  text-align:center;
  font-size:11px;
  color:#6b7280;
  margin:18px 0;
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="header">
  <div class="header-inner">
    <div class="header-logo">
      <img src="https://upload.wikimedia.org/wikipedia/commons/8/88/Scout_and_Guide_Emblem_of_India.svg">
    </div>
    <div class="header-text">
      <h1>Bharat Scout & Guide</h1>
      <p>District Office â€“ Dungarpur</p>
    </div>
  </div>
</div>

<!-- CARD -->
<div class="card">

<!-- FORM -->
<div id="formScreen">
  <label>Camp Date</label>
  <select id="campDate" required></select>

  <label>Student Name</label>
  <input id="name" required>

  <label>School Name</label>
  <input id="school" required>

  <label>Mobile Number</label>
  <input id="mobile" pattern="[0-9]{10}" required>

  <label>Upload Release Order</label>
  <div class="file-box">
    <input type="file" id="file" accept="image/*,.pdf" required>
  </div>

  <button onclick="showPreview()">Preview Details</button>
</div>

<!-- PREVIEW -->
<div id="previewScreen" class="preview">
  <div class="preview-card">
    <b>Camp Date:</b> <span id="pCamp"></span><br>
    <b>Name:</b> <span id="pName"></span><br>
    <b>School:</b> <span id="pSchool"></span><br>
    <b>Mobile:</b> <span id="pMobile"></span>
    <div id="filePreview"></div>
  </div>

  <div class="actions">
    <button class="back" onclick="backToForm()">Edit</button>
    <button class="confirm" onclick="submitData()">Confirm & Submit</button>
  </div>

  <div class="loader" id="loader">
    <span></span><span></span><span></span>
  </div>

  <div id="status"></div>
</div>

</div>

<div class="footer">
Â© Bharat Scout & Guide â€“ Dungarpur
</div>

<script>
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbwgKM1LPLLjRf-eGX6hGTSHxICDs7KLg_Uf9NWzTJspkRIbvWA-n0Cn1SBTzk9HR5Dv/exec";

let fileBase64="",fileType="",fileName="";

/* LOAD CAMP DATES */
fetch(SCRIPT_URL+"?action=campDates")
.then(r=>r.json())
.then(list=>{
  campDate.innerHTML='<option value="">Select Camp Date</option>';
  list.forEach(d=>campDate.innerHTML+=`<option>${d}</option>`);
});

function showPreview(){
  const f=file.files[0];
  if(!f)return alert("Upload file first");

  const r=new FileReader();
  r.onload=()=>{
    fileBase64=r.result.split(",")[1];
    fileType=f.type;
    fileName=f.name;

    pCamp.innerText=campDate.value;
    pName.innerText=name.value;
    pSchool.innerText=school.value;
    pMobile.innerText=mobile.value;

    filePreview.innerHTML="";
    if(fileType.includes("image")){
      filePreview.innerHTML=`<img class="preview-img" src="${r.result}">`;
    }else{
      filePreview.innerHTML=`<div class="pdf-box">ðŸ“„ ${fileName}</div>`;
    }

    formScreen.style.display="none";
    previewScreen.style.display="block";
  };
  r.readAsDataURL(f);
}

function backToForm(){
  previewScreen.style.display="none";
  formScreen.style.display="block";
}

function submitData(){
  loader.style.display="block";

  fetch(SCRIPT_URL,{
    method:"POST",
    body:JSON.stringify({
      campDate:campDate.value,
      name:name.value,
      school:school.value,
      mobile:mobile.value,
      file:fileBase64,
      fileType:fileType,
      fileName:fileName
    })
  })
  .then(r=>r.json())
  .then(res=>{
    loader.style.display="none";
    status.style.color="green";
    status.innerHTML=`âœ… Submitted Successfully<br>Confirmation No: <b>${res.confirmation}</b>`;
  })
  .catch(()=>{
    loader.style.display="none";
    status.style.color="red";
    status.innerHTML="Submission failed. Try again.";
  });
}
</script>

</body>
</html>
