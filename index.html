<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Bharat Scout & Guide – Release Order</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{margin:0;font-family:Poppins;background:linear-gradient(135deg,#0b3d2e,#145a44)}
.container{max-width:420px;margin:25px auto;background:#fff;border-radius:16px;padding:20px;box-shadow:0 20px 40px rgba(0,0,0,.3)}
.logo{text-align:center}
.logo img{width:70px}
h2{text-align:center;color:#0b3d2e;margin:10px 0 5px}
.sub{text-align:center;font-size:13px;color:#555}
label{font-size:13px;font-weight:600}
input,select{width:100%;padding:11px;margin:6px 0 14px;border-radius:8px;border:1px solid #ccc}
button{width:100%;background:#0b3d2e;color:#fff;border:none;padding:13px;font-size:16px;border-radius:10px}
button:disabled{background:#999}
.loader{text-align:center;display:none}
.loader span{width:8px;height:8px;background:#0b3d2e;border-radius:50%;display:inline-block;animation:b 1.4s infinite}
.loader span:nth-child(2){animation-delay:.2s}
.loader span:nth-child(3){animation-delay:.4s}
@keyframes b{0%,80%,100%{transform:scale(0)}40%{transform:scale(1)}}
.success{background:#eafaf1;border:1px solid #b6e3c7;padding:15px;border-radius:12px}
.success a{display:block;margin-top:10px;background:#0b3d2e;color:#fff;padding:10px;border-radius:8px;text-decoration:none}
.whatsapp{background:#25d366}
footer{text-align:center;font-size:11px;color:#777;margin-top:15px}
</style>
</head>

<body>

<div class="container">
<div class="logo">
<img src="https://upload.wikimedia.org/wikipedia/commons/8/88/Scout_and_Guide_Emblem_of_India.svg">
</div>

<h2>Bharat Scout & Guide</h2>
<p class="sub">District Office – Dungarpur</p>

<form id="form">
<label>Camp Date</label>
<select id="campDate" required>
<option>Loading...</option>
</select>

<label>Name</label>
<input id="name" required>

<label>School</label>
<input id="school" required>

<label>Mobile</label>
<input id="mobile" pattern="[0-9]{10}" required>

<label>Upload Release Order</label>
<input type="file" id="file" required>

<button id="btn">Submit</button>
</form>

<div class="loader" id="loader"><span></span><span></span><span></span></div>
<div id="status"></div>

<footer>© Bharat Scout & Guide – Dungarpur</footer>
</div>

<script>
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbwgKM1LPLLjRf-eGX6hGTSHxICDs7KLg_Uf9NWzTJspkRIbvWA-n0Cn1SBTzk9HR5Dv/exec";

// LOAD CAMP DATES
fetch(SCRIPT_URL+"?action=campDates")
.then(r=>r.json())
.then(d=>{
  campDate.innerHTML='<option value="">Select Camp Date</option>';
  d.forEach(x=>{
    campDate.innerHTML+=`<option>${x}</option>`;
  });
});

form.onsubmit=e=>{
e.preventDefault();
const f=file.files[0];
if(f.size>2*1024*1024)return alert("Max 2MB");
btn.disabled=true;loader.style.display="block";

const r=new FileReader();
r.onload=()=>{
fetch(SCRIPT_URL,{
method:"POST",
body:JSON.stringify({
campDate:campDate.value,
name:name.value,
school:school.value,
mobile:mobile.value,
file:r.result.split(",")[1],
fileType:f.type
})
})
.then(r=>r.json())
.then(res=>{
loader.style.display="none";btn.disabled=false;

if(res.status==="duplicate"){
status.innerHTML=res.message;return;
}

status.innerHTML=`
<div class="success">
<b>Submitted Successfully</b><br>
Confirmation No: ${res.confirmation}
<a href="${res.pdfUrl}" target="_blank">Download PDF</a>
<a class="whatsapp" target="_blank"
href="https://wa.me/919610841436?text=${encodeURIComponent(
`BSG Dungarpur
Release Order Submitted
Name: ${name.value}
Camp: ${campDate.value}
Confirmation: ${res.confirmation}`
)}">Send WhatsApp</a>
</div>`;
form.reset();
});
};
r.readAsDataURL(f);
}
</script>
</body>
</html>
